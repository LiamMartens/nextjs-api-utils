image: node:latest

cache:
  paths:
    - node_modules/

build:
  only:
    - master
  script:
    - VERSION=$(echo "console.log(require('./package.json').version)" | node $1)
    - yarn install
    - yarn build
    - npm config set registry 'https://gitlab.com/api/v4/projects/${CI_PROJECT_ID}/packages/npm/'
    - npm config set '//gitlab.com/api/v4/projects/${CI_PROJECT_ID}/packages/npm/:_authToken' "${CI_JOB_TOKEN}"
    - npm config set '//gitlab.com/api/v4/packages/npm/:_authToken' "${CI_JOB_TOKEN}"
    - npm publish
